# Teufel Raumfeld (Raumkernel Addon)

![Supports aarch64 Architecture][aarch64-shield]
![Supports amd64 Architecture][amd64-shield]

A Home Assistant Add-on that provides a bridge to Teufel Raumfeld devices using the `node-raumkernel` library.

## Description

This add-on allows Home Assistant to communicate with Teufel Raumfeld multi-room audio systems. It wraps the `node-raumkernel` library and exposes a WebSocket API that the corresponding Home Assistant integration uses to control playback, volume, and grouping.

## Features

- **Stable Room Entities**: Provides consistent identifiers for your Raumfeld rooms.
- **Unified Control**: Seamlessly handles the transition between standalone playback and zone-based grouping.
- **WebSocket API**: High-performance communication between the add-on and the integration.
- **Auto-Install Integration**: Automatically installs and updates the HA integration on startup.

## Configuration

| Option                | Default | Description                                |
| --------------------- | ------- | ------------------------------------------ |
| `LOG_LEVEL`           | `2`     | Logging verbosity (0-4)                    |
| `PORT`                | `3000`  | WebSocket server port                      |
| `ENABLE_AUTO_INSTALL` | `true`  | Auto-install/update integration on startup |

---

## Developer Documentation

### Version Management

Version is defined in `config.yaml` and synced to all other files:

```bash
# After changing version in config.yaml:
./sync-version.sh
# Syncs to: package.json, manifest.json
```

### Build Workflow

```bash
# Prepare for build (syncs versions + bundles integration)
./prepare-build.sh

# Deploy to remote HA for testing
./deploy_remote.sh
```

### Auto-Install Architecture

On startup, the addon:

1. Checks if integration exists in `/homeassistant/custom_components/`
2. Compares bundled vs installed version
3. Copies files if missing or outdated
4. Creates HA persistent notification to prompt restart

Key files:

- `IntegrationManager.js` — Install/update logic
- `/integration/` — Bundled integration files (generated by `prepare-build.sh`)
